---
layout: project
title: "Particulate Air Concentration in the SLC Basin"
author: "Greg Lee"
categories: documentation
tags: [documentation]
image: pm_slc.jpg
---
Particulate matter 2.5 (PM2.5) is a carcinogenic material associated with adverse cardiovascular events and cancer incidence. In the winter, Utah experiences acute inversions which trap particulates close to the urban population. The study of these particulates are critical in helping the Utahn population properly mitigate exposure. Herein, an analysis is performed on scraped, hourly PurpleAir and AirNow PM2.5 exposures from April 7th-14th. Primary findings demonstrate PurpleAir sensors to have better rural coverage and decreased accuracy when compared to the Environmental Protection Agency's (EPA) AirNow measurements.

### Background
The Salt Lake City basin is an established outdoor kingpin with a rapidly expanding technology sector. The geographic shape of the region leads to “sinkholes” of pollution with notably high concentrations of particulate matter and ozone. With reduced wind and precipitation, warm air traps pollutants in the basin resulting in high pollutant concentrations, breathable by city dwellers. These trapped toxins are dangerous to human health. Particulate matter 2.5 (PM2.5) is robustly associated with many negative disease outcomes including non-fatal heart attacks, asthma and increased cancer risk.


![Inversion from Mt. Baldy, Alta](/assets/img/inversion.JPG){:class="project-featured-image"}

### Data Collection
Two entities which monitor and predict particulate matter concentrations are the Environmental Protection Agency (EPA) and Purple Air. The EPA tracks air quality in real-time via a network of sensors known as [AirNow](https://www.airnow.gov/). These data are available at minute intervals, starting in 1990, via an API on their website. The spatial coverage in Utah is limited since there are only a few sensors (N=27 in 2020) nearby areas of high urban density. [PurpleAir](https://www2.purpleair.com/) (1030 Legacy Sensors and 524 Experimental Sensors in 2020) publicly release real-time data via a web portal with no back-log. One advantage to PurpleAir data is its widespread spatial coverage, especially in the Salt Lake City basin. [DISCLOSE ABOUT THE ACCURACY]

![Sensor Locations](/assets/img/sensor_locations.png){:class='project-featured-image'}

AirNow and PurpleAir sensors detect several different pollutants including particulate matter and ozone. PurpleAir tracks a greater number of particulates, notably PM2.5, PM10 and volatile organic compounds while AirNow sensors only record PM2.5. Additionally, PurpleAir sensors measure temperature, humidity, and pressure. Within Utah, the tracking, analysis and forecasting of PM2.5 is critical in protecting public health. Few studies analyze the PurpleAir data as public data access is limited. In order to explore how the COVID-19 pandemic stay-at-home guidelines are affecting air quality in Utah, I collected and analyzed hourly PM2.5 data from PurpleAir and EPA Airnow for the week of April 7th to 14th. Please note, both data repositories are publicly accessible. Often, PurpleAir sensors are placed on residential properties and users have consented for their information to be shared publicly. AirNow sensor data are curated and released by the EPA. Data does not contain any information about the property or residents, simply the location (Lat/Lon). For additional questions concerning data privacy, please visit the [PurpleAir](https://www2.purpleair.com/policies/privacy-policy) [AirNow](https://docs.airnowapi.org/faq) websites.

Hourly AirNow measurements were queried from their [API](https://docs.airnowapi.org/)from April 7th to April 14th for 2019 and 2020. The PurpleAir data collection was a bit more complex as data had to be collected in real-time and downloaded to a local database. In order to automate this task, a directed acyclical graph (DAG) was created in Apache Airflow. This program collected hourly measurements starting April 7th at 5:00 AM MST till April 14th at 5:00AM MST. Code for this application can be found within the repository under [purp_air.py](needgithublink). It was necessary to run this program with an Airflow pipeline as the collection [link](https://docs.google.com/document/d/15ijz94dXJ-YAZLi9iZ_RaBwrZ4KtYeCy08goGBwnbCU/edit) would go offline. Airflow is capable hierarchical collection, forcing the program to retry until collection was completed.


### Data Cleaning
Data cleaning represented the crux of this project due to data sparsity and standardization. The PurpleAir data contained roughly 170,000 entries recorded by 1,030 sensors. Visualization of the null values showcased that approximately 6% of the PurpleAir data was missing PM2.5 values and 45% of other variables of interest such as pressure, temperature and humidity. The Airnow data contained no missing values. In order to fill the PurpleAir missing values, an algorithm was created to fill values based upon spatially and temporally most relevant sensor. In simple, values were filled with information from the closest sensor with a time match. Due to the inefficiency of the algorithm created, this process was slow. After running, several points had to be dealt with by hand as no other sensors of reasonable proximity had data for the desired time point. For these values, a simple average based upon the time hour was inserted. This filling step is perhaps the most simplistic and introduces the most bias into the analysis.

Once missing data was filled, a quality control step was performed to compare the PurpleAir measurements to the Airnow measurements within 2020. Initially, an exact comparison was made between the PurpleAir and Airnow sensors to see if an exact comparison could be made. Unfortunately this returned no values. Next, a spatial join was performed to align zip codes and cities with each of the latitude/longitude of the sensors. Mean hourly measurements were created for each of the overlapping zip codes. To compare the sensors, an absolute difference of the value was taken. On average, the PurpleAir sensors deviated by 2.16 ug/m3 from the Airnow data. This value was greater than 1 standard deviation of the Airnow data, supporting the inaccuracy of the PurpleAir concentrations. In an attempt to align the concentrations of the Airnow and PurpleAir data, a multiple-regression was created with the existing PurpleAir features to predict a given Airnow concentration. Unfortunately, the r-squared of this model was low, ~27%, implying this task was not linearly correlated. As such, a decision was made to examine and compare the data sources independently, acknowledging that trends may be revealed but specific concentrations of PurpleAir data were not accurate.

### Analysis
Next, measurements were spatially aggregated by city and averaged daily. These plots showcase that overall PM2.5 levels in the state of Utah were below 10 for the week of April 7th – 14th for both 2019 and 2020. No noticeable changes are visible based between 2019 and 2020. Comparison of PurpleAir and Airnow in 2020 yielded upregulated PM2.5 in Coalville, Goshen and North Logan. These observations were missed by the Airnow monitors due to their limited spatial coverage. Examination of daily trends showcased that Airnow monitors may also smooth their data, as temporal cycles expected of particulate matter were not visible. PurpleAir data has more of these cycles, with some evidence of bimodal daily peaks around 9AM and 5PM. Thus, while Airnow data appears to be more accurate, PurpleAir data contributes data on rural communities and hourly specificity. When smoothed with a 24 hour rolling filter, the PurpleAir data appears to mirror the trends of the Airnow data, although the magnitude of the concentrations are still inaccurate.

A basic prediction was attempted utilizing Facebook’s prophet package. Two models were created, one based upon the PurpleAir data and another on the Airnow data. Overall, the PurpleAir model seemed to give more accurate predictions as the Airnow model seemed constrained by the limited noise within the data. Neither of these models performs well though as the amount of data is limited and the trends are not representative for future days. More information should be included to improve prediction such as weather and traffic data.

### Conclusions
In total, this exploration showcases the true “wrangling” attitude necessary to explore large, unrefined datasets. PurpleAir sensor concentrations should not be considered accurate in comparison to EPA sensors. Yet, these sensors do catch high spatial and temporal variability which may be beneficial in alerting surrounding populations of dangerous air spikes, although the magnitude of the danger may be difficult to quantify. The greatest limitation of these analysis was the lack of data. With an extended period of time, more PurpleAir data could be beneficial to researchers and the population as a whole. Assumptions for cleaning the data should be verified and other options, such as recurrent neural networks, for filling data should be explored. Finally, if these data were ever used for predictions, more data should be included and for greater timespan. In total, this project acts as a fantastic initial exploration of a novel data source. While somewhat inaccurate, PurpleAir data represents a large repository for fine spatial monitoring of rural and urban particulates in real-time.
